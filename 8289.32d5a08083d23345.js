"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8289],{8289:(X,y,a)=>{a.r(y),a.d(y,{CarBrandDetectedComponent:()=>O});var m=a(4121),h=a(2147),p=a(3291),u=a(7241),g=a(334),D=a(3815),f=a.n(D);class T{constructor(t){this.classNames=t}getPredictedClass(t){if(!t||0===t.length){const i=[];for(let s=0;s<5;s++)i.push({name:"-",probability:0,index:0});return i}const e=Array.prototype.slice.call(t),r=this.softmax(e);return this.getClass(r,5)}softmax(t){const e=Math.max(...t),r=t.map(s=>Math.exp(s-e)).reduce((s,o)=>s+o);return t.map((s,o)=>Math.exp(s-e)/r)}getClass(t,e=10){const i=(f().isTypedArray(t)?Array.prototype.slice.call(t):t).map((c,b)=>[c,b]),s=f().sortBy(i,c=>c[0]),o=f().reverse(s);return f().take(o,e).map(c=>{const b=this.classNames[c[1]];return{id:b[0],index:parseInt(c[1],10),name:b,probability:Number((100*c[0]).toFixed(2))}})}}class S{get model(){return this._model.getValue()}set model(t){this._model.getValue()!==t&&this._model.next(t)}constructor(t){this._model=new m.X(null),this.model$=this._model.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),g.YLj(t,{onProgress:e=>{console.log(e)}}).then(e=>{this._model.next(e)}).catch(()=>{})}dispose(){this._model.complete(),this._model.unsubscribe()}}var l=(()=>((l=l||{})[l.FromYolo=0]="FromYolo",l[l.FromTensorflow=1]="FromTensorflow",l))();class B extends S{get classAndProbability(){return this._classAndProbability.getValue()}set classAndProbability(t){this._classAndProbability.getValue()!==t&&this._classAndProbability.next(t)}constructor(t,e,r=224,i=224){super(t),this.classes=e,this.imageShapeX=r,this.imageShapeY=i,this._classAndProbability=new m.X(null),this.classAndProbability$=this._classAndProbability.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),this._classAndProbability.next(new T(e))}predict(t,e){return e===l.FromTensorflow?this.fromTensorflow(t):this.fromYoloConvertedToTensorflow(t)}predictByBase64(t,e){return e===l.FromTensorflow?this.fromTensorflowBase64(t):this.fromYoloConvertedToTensorflowBase64(t)}fromTensorflowBase64(t){return new u.y(e=>{const r=this.model,i=new Image(this.imageShapeX,this.imageShapeY);i.onload=()=>{let s=g.Xhn.fromPixels(i,3).resizeNearestNeighbor([this.imageShapeX,this.imageShapeY]).expandDims().toFloat();r&&r.execute(s).data().then(o=>{var C=this.classAndProbability?.getPredictedClass(o);e.next(C)})},i.src=t})}fromTensorflow(t){const e=this.model;return new u.y(r=>{let i=g.Xhn.fromPixels(t,3).resizeNearestNeighbor([this.imageShapeX,this.imageShapeY]).expandDims().toFloat();e&&e.execute(i).data().then(s=>{var o=this.classAndProbability?.getPredictedClass(s);r.next(o)})})}fromYoloConvertedToTensorflowBase64(t){return new u.y(e=>{const r=this.model,i=new Image(this.imageShapeX,this.imageShapeY);i.onload=()=>{let s=g.Xhn.fromPixels(i,3).resizeNearestNeighbor([this.imageShapeX,this.imageShapeY]).toFloat().div(g.iD$(255)).expandDims();r&&r.execute(s).data().then(o=>{var C=this.classAndProbability?.getPredictedClass(o);e.next(C)})},i.src=t})}fromYoloConvertedToTensorflow(t){const e=this.model;return new u.y(r=>{let i=g.Xhn.fromPixels(t,3).resizeNearestNeighbor([this.imageShapeX,this.imageShapeY]).expandDims().toFloat();e&&e.execute(i).data().then(s=>{var o=this.classAndProbability?.getPredictedClass(s);r.next(o)})})}}var P=a(8207),x=a(8168),A=a(3568),F=a(9018),Y=a(89),v=a(1947),n=a(5095);const w=["img"],M=["file"];let O=(()=>{class d{get modelPredictCarDirection(){return this._modelPredictCarDirection.getValue()}set modelPredictCarDirection(e){this._modelPredictCarDirection.getValue()!==e&&this._modelPredictCarDirection.next(e)}get modelPredictCarBrand(){return this._modelPredictCarBrand.getValue()}set modelPredictCarBrand(e){this._modelPredictCarBrand.getValue()!==e&&this._modelPredictCarBrand.next(e)}get srcImage(){return this._srcImage.getValue()}set srcImage(e){this._srcImage.getValue()!==e&&this._srcImage.next(e)}get brand(){return this._brand.getValue()}set brand(e){this._brand.getValue()!==e&&this._brand.next(e)}constructor(e){this.plataform=e,this.ret=[],this._modelPredictCarDirection=new m.X(null),this.modelPredictCarDirection$=this._modelPredictCarDirection.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),this._modelPredictCarBrand=new m.X(null),this.modelPredictCarBrand$=this._modelPredictCarBrand.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),this.img=null,this.file=null,this._srcImage=new m.X(""),this.srcImage$=this._srcImage.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),this._brand=new m.X(""),this.brand$=this._brand.asObservable().pipe((0,h.x)(),(0,p.d)({bufferSize:1,refCount:!0})),this._modelPredictCarDirection.next(new B("assets/car_position/model.json",v.RL)),this._modelPredictCarBrand.next(new B("assets/carBrand/model.json",v.Jc))}ngOnInit(){this._srcImage.pipe((0,x.b)(e=>{this.img?.nativeElement.setAttribute("src",e),this.modelPredictCarDirection&&this.modelPredictCarBrand&&this.predictSideCar(e)})).subscribe()}predictSideCar(e){this.modelPredictCarBrand&&this.modelPredictCarDirection?.predictByBase64(e,l.FromYolo).pipe((0,x.b)(r=>{"Front"===r[0].name&&this.modelPredictCarBrand?this.predictCarBrand(e):this._brand.next("Could not identify as a car"!==r[0].name?`The car is on "${r[0].name}" and must be Front`:r[0].name)}),(0,A.K)(r=>F.E)).subscribe()}predictCarBrand(e){this.modelPredictCarBrand&&this.modelPredictCarBrand.predictByBase64(e,l.FromYolo).pipe((0,x.b)(r=>{this._brand.next(r[0].name)})).subscribe()}predictImage(){this.img?.nativeElement&&this.modelPredictCarDirection?.predict(this.img?.nativeElement,l.FromYolo).subscribe(e=>{this.ret=e})}fileUpload(e){const r=e.target.files[0],i=new FileReader;i.onloadend=s=>{(new Image).src=s.target.result,this._srcImage.next(s.target.result)},i.readAsDataURL(r)}clickFileUpload(){this.file?.nativeElement.click()}ngOnDestroy(){this._modelPredictCarDirection.complete(),this._modelPredictCarDirection.unsubscribe(),this._modelPredictCarBrand.complete(),this._modelPredictCarBrand.unsubscribe(),this._srcImage.complete(),this._srcImage.unsubscribe(),this._brand.complete(),this._brand.unsubscribe()}}return d.\u0275fac=function(e){return new(e||d)(n.Y36(P.t4))},d.\u0275cmp=n.Xpm({type:d,selectors:[["app-car-brand-detected"]],viewQuery:function(e,r){if(1&e&&(n.Gf(w,7),n.Gf(M,7)),2&e){let i;n.iGM(i=n.CRH())&&(r.img=i.first),n.iGM(i=n.CRH())&&(r.file=i.first)}},standalone:!0,features:[n._Bn([]),n.jDz],decls:12,vars:1,consts:[["id","container"],[2,"display","flex","flex-direction","column","align-items","center","margin-top","50px"],["img",""],["hidden","","accept",".jpg,.jpeg","type","file",3,"change"],["file",""],[1,"buttons"],[3,"click"]],template:function(e,r){1&e&&(n.TgZ(0,"div",0)(1,"div",1),n._UZ(2,"img",null,2),n.TgZ(4,"div"),n._uU(5),n.qZA()(),n.TgZ(6,"div")(7,"input",3,4),n.NdJ("change",function(s){return r.fileUpload(s)}),n.qZA(),n.TgZ(9,"div",5)(10,"ion-button",6),n.NdJ("click",function(){return r.clickFileUpload()}),n._uU(11,"Upload Car Picture "),n.qZA()()()()),2&e&&(n.xp6(5),n.hij(" ** ",r.brand," ** "))},dependencies:[P.Pc,P.YG,Y.ez],styles:["ion-menu-button[_ngcontent-%COMP%]{color:var(--ion-color-primary)}#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}img[_ngcontent-%COMP%]{max-width:224px;max-height:224px}"]}),d})()}}]);